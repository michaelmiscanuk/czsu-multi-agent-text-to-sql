<mxfile host="Electron" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/29.0.3 Chrome/140.0.7339.249 Electron/38.7.0 Safari/537.36" version="29.0.3">
  <diagram id="langgraph-nodes-v4" name="LangGraph High-Level Architecture">
    <mxGraphModel dx="1213" dy="795" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1000" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title" value="&lt;b&gt;&lt;font style=&quot;font-size: 24px;&quot;&gt;Multi-Agent Text-to-SQL Architecture&lt;/font&gt;&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Helvetica;" parent="1" vertex="1">
          <mxGeometry x="200" y="30" width="600" height="50" as="geometry" />
        </mxCell>
        <mxCell id="query_start" value="&lt;b&gt;QUERY&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;fontStyle=1;arcSize=15;align=center;verticalAlign=middle;fontFamily=Helvetica;fontColor=default;gradientColor=#B9E0A5;" parent="1" vertex="1">
          <mxGeometry x="400" y="120" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="parallel_retrieval_bg" value="&lt;b style=&quot;font-style: normal;&quot;&gt;Parallel Retrieval&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;fontStyle=1;opacity=20;align=center;verticalAlign=top;spacingLeft=10;spacingTop=5;fontFamily=Helvetica;fontColor=default;gradientColor=none;" parent="1" vertex="1">
          <mxGeometry x="150" y="220" width="700" height="200" as="geometry" />
        </mxCell>
        <mxCell id="sql_search" value="&lt;b&gt;SQL Search&lt;/b&gt;" style="ellipse;whiteSpace=wrap;html=1;fillColor=#e1bee7;strokeColor=#7B1FA2;fontSize=11;fontStyle=1;gradientColor=#CE93D8;align=center;verticalAlign=middle;fontFamily=Helvetica;fontColor=default;" parent="1" vertex="1">
          <mxGeometry x="200" y="280" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="pdf_search" value="&lt;b&gt;PDF Search&lt;/b&gt;" style="ellipse;whiteSpace=wrap;html=1;fillColor=#b2dfdb;strokeColor=#00796B;fontSize=11;fontStyle=1;gradientColor=#80CBC4;align=center;verticalAlign=middle;fontFamily=Helvetica;fontColor=default;" parent="1" vertex="1">
          <mxGeometry x="620" y="280" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="generate_query" value="&lt;b&gt;Generate Query&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;fontStyle=1;gradientColor=#FF9999;align=center;verticalAlign=middle;fontFamily=Helvetica;fontColor=default;" parent="1" vertex="1">
          <mxGeometry x="200" y="480" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="reflect" value="&lt;b&gt;Reflect&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;fontStyle=1;align=center;gradientColor=#FF9999;" parent="1" vertex="1">
          <mxGeometry x="200" y="600" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="format" value="&lt;b&gt;Format&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#AD1457;fontSize=11;fontStyle=1;gradientColor=#F8BBD0;align=center;verticalAlign=middle;fontFamily=Helvetica;fontColor=default;" parent="1" vertex="1">
          <mxGeometry x="410" y="720" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="answer_end" value="&lt;b&gt;ANSWER&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;fontStyle=1;arcSize=15;align=center;verticalAlign=middle;fontFamily=Helvetica;fontColor=default;gradientColor=#B9E0A5;" parent="1" vertex="1">
          <mxGeometry x="400" y="850" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="arrow_q_sql" value="" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;exitX=0.25;exitY=1;exitDx=0;exitDy=0;" parent="1" source="query_start" target="sql_search" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow_q_pdf" value="" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="1" source="query_start" target="pdf_search" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow_sql_gen" value="" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="sql_search" target="generate_query" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow_gen_reflect" value="" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="generate_query" target="reflect" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow_reflect_gen" value="&lt;b&gt;Needs Improvement&lt;/b&gt;" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;dashed=1;dashPattern=8 8;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="reflect" target="generate_query" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="100" y="625" />
              <mxPoint x="100" y="505" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow_reflect_format" value="&lt;b&gt;Enough Information&lt;/b&gt;" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="reflect" target="format" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow_pdf_format" value="" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="pdf_search" target="format" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="710" y="600" />
              <mxPoint x="710" y="745" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow_format_answer" value="" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="format" target="answer_end" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="legend_bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FAFAFA;strokeColor=#9E9E9E;fontSize=12;shadow=1;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="50" y="120" width="100" height="320" as="geometry" />
        </mxCell>
        <mxCell id="legend_title" value="&lt;b&gt;Legend&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Helvetica;fontSize=13;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="130" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend_sql" value="SQL&lt;br&gt;Search" style="ellipse;whiteSpace=wrap;html=1;fillColor=#e1bee7;strokeColor=#7B1FA2;fontSize=9;gradientColor=#CE93D8;align=center;verticalAlign=middle;fontFamily=Helvetica;fontColor=default;" parent="1" vertex="1">
          <mxGeometry x="60" y="180" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="legend_pdf" value="PDF&lt;br&gt;Search" style="ellipse;whiteSpace=wrap;html=1;fillColor=#b2dfdb;strokeColor=#00796B;fontSize=9;gradientColor=#80CBC4;align=center;verticalAlign=middle;fontFamily=Helvetica;fontColor=default;" parent="1" vertex="1">
          <mxGeometry x="60" y="235" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="legend_gen" value="Generate&lt;br&gt;Query" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;gradientColor=#FF9999;align=center;verticalAlign=middle;fontFamily=Helvetica;fontColor=default;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="60" y="290" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend_reflect" value="Reflect" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;gradientColor=#FF9999;align=center;verticalAlign=middle;fontFamily=Helvetica;fontColor=default;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="60" y="335" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend_format" value="Format" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#AD1457;fontSize=9;gradientColor=#F8BBD0;align=center;verticalAlign=middle;fontFamily=Helvetica;fontColor=default;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="60" y="380" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="desc_bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#616161;fontSize=12;shadow=1;strokeWidth=2;align=left;verticalAlign=top;spacingTop=10;spacingLeft=15;" parent="1" vertex="1">
          <mxGeometry x="50" y="960" width="280" height="200" as="geometry" />
        </mxCell>
        <mxCell id="desc_title" value="&lt;b style=&quot;font-size: 14px;&quot;&gt;System Overview&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Helvetica;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="65" y="975" width="250" height="25" as="geometry" />
        </mxCell>
        <mxCell id="desc_content" value="&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;b&gt;Query Processing:&lt;/b&gt;&lt;br&gt;User query initiates parallel search across structured (SQL) and unstructured (PDF) data sources.&lt;br&gt;&lt;br&gt;&lt;b&gt;Iterative Refinement:&lt;/b&gt;&lt;br&gt;SQL results undergo query generation, execution, and reflection with feedback loops for improvement. The system can iterate between Generate Query and Reflect until satisfactory results are achieved.&lt;br&gt;&lt;br&gt;&lt;b&gt;Response Generation:&lt;/b&gt;&lt;br&gt;Both results are combined into one coherent answer in the Format step, and this is what is returned to the user. There are more steps and agents involved in the process that we will examine more in the detailed diagram, but here we also note that Summarize steps occur throughout the execution several times, not only at the end. Summarize allows us to keep the context when we do the follow up query but also to keep token count at bay to reduce costs and increase the speed of execution.&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Helvetica;spacingLeft=5;" parent="1" vertex="1">
          <mxGeometry x="65" y="1010" width="250" height="140" as="geometry" />
        </mxCell>
        <mxCell id="tech_bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1976D2;fontSize=12;shadow=1;strokeWidth=2;align=center;verticalAlign=top;spacingTop=10;" parent="1" vertex="1">
          <mxGeometry x="670" y="960" width="280" height="200" as="geometry" />
        </mxCell>
        <mxCell id="tech_title" value="&lt;b style=&quot;font-size: 14px;&quot;&gt;Technology Stack&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Helvetica;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="670" y="975" width="280" height="25" as="geometry" />
        </mxCell>
        <mxCell id="tech_content" value="&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;b&gt;Framework:&lt;/b&gt; LangGraph, LangChain&lt;br&gt;&lt;b&gt;Vector Store:&lt;/b&gt; ChromaDB&lt;br&gt;&lt;b&gt;Database:&lt;/b&gt; SQLite, PostgreSQL&lt;br&gt;&lt;b&gt;LLM:&lt;/b&gt; Azure OpenAI GPT-4o, GPT-4o-mini&lt;br&gt;&lt;b&gt;Reranking:&lt;/b&gt; Cohere Rerank API&lt;br&gt;&lt;b&gt;Document Processing:&lt;/b&gt; LlamaParse&lt;br&gt;&lt;b&gt;Embedding:&lt;/b&gt; OpenAI Embeddings&lt;br&gt;&lt;b&gt;Search:&lt;/b&gt; Hybrid (Semantic + BM25)&lt;br&gt;&lt;b&gt;Backend:&lt;/b&gt; FastAPI, Python&lt;br&gt;&lt;b&gt;Frontend:&lt;/b&gt; Next.js, React&lt;br&gt;&lt;b&gt;Checkpointing:&lt;/b&gt; AsyncPostgresSaver&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Helvetica;spacingLeft=20;" parent="1" vertex="1">
          <mxGeometry x="685" y="1010" width="250" height="140" as="geometry" />
        </mxCell>
        <mxCell id="features_bg2" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#E65100;fontSize=12;shadow=1;strokeWidth=2;align=center;verticalAlign=top;spacingTop=10;" parent="1" vertex="1">
          <mxGeometry x="50" y="1180" width="900" height="100" as="geometry" />
        </mxCell>
        <mxCell id="features_title2" value="&lt;b style=&quot;font-size: 14px;&quot;&gt;Core Capabilities&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Helvetica;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="1195" width="900" height="25" as="geometry" />
        </mxCell>
        <mxCell id="features_content2" value="&lt;font style=&quot;font-size: 11px;&quot;&gt;✓ Natural Language to SQL Translation with agentic tool calling (LLM autonomously decides when to execute queries)&lt;br&gt;✓ Hybrid RAG: Parallel retrieval from structured (database selections) and unstructured (PDF documentation) sources&lt;br&gt;✓ Self-Reflection &amp;amp; Query Validation: Iterative improvement loop with decision-making (improve/answer)&lt;br&gt;✓ Context-Aware Response Generation: Multi-source synthesis with bilingual support (Czech/English)&lt;br&gt;✓ Memory Management: Automatic message summarization at key points to maintain token efficiency&lt;br&gt;✓ Checkpointing: PostgreSQL-based state persistence for workflow resumption and conversation history&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Helvetica;spacingLeft=20;" parent="1" vertex="1">
          <mxGeometry x="65" y="1225" width="870" height="45" as="geometry" />
        </mxCell>
        <mxCell id="note_parallel" value="&lt;i&gt;Parallel retrieval&lt;/i&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Helvetica;fontSize=10;fontColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="430" y="220" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="note_loop" value="&lt;i&gt;Iterative refinement loop&lt;/i&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Helvetica;fontSize=10;fontColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="30" y="550" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="footer" value="&lt;i&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;Multi-Agent Text-to-SQL System • High-level node-based architecture with iterative query refinement • Master&#39;s Thesis 2024&lt;/font&gt;&lt;/i&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Helvetica;fontColor=#757575;" parent="1" vertex="1">
          <mxGeometry x="200" y="1300" width="600" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
